<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presupuestos - Gestiones Lamda</title>
    <link rel="stylesheet" href="/css/presupuestos.css">
    <link rel="stylesheet" href="../css/action-buttons.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä M√≥dulo de Presupuestos</h1>
            <a href="http://localhost:3000" class="back-button">‚Üê Volver al inicio</a>
        </header>

        <main>
            <div class="welcome-section">
                <h2>Gesti√≥n de Presupuestos</h2>
                <p>Visualizaci√≥n y sincronizaci√≥n de presupuestos desde Google Sheets</p>
                
                <!-- Indicador de estado del m√≥dulo -->
                <div id="status-indicator" class="status-indicator">
                    <span class="status-dot"></span>
                    <span id="status-text">Cargando m√≥dulo...</span>
                </div>
            </div>

            <!-- Panel de estad√≠sticas -->
            <div class="stats-panel">
                <div class="stat-card">
                    <h3>Total Registros</h3>
                    <span id="total-registros" class="stat-value">-</span>
                </div>
                <div class="stat-card">
                    <h3>Tipos de comprobante</h3>
                    <span id="total-categorias" class="stat-value">-</span>
                </div>
                <div class="stat-card">
                    <h3>Monto Total</h3>
                    <span id="monto-total" class="stat-value">$-</span>
                </div>
                <div class="stat-card">
                    <h3>√öltima Sync</h3>
                    <span id="ultima-sync" class="stat-value">-</span>
                </div>
            </div>

            <!-- Controles principales -->
            <div class="controls-section">
                <div class="controls-left">
                    <button id="btn-cargar-datos" class="btn-primary">
                        üìä Cargar Presupuestos
                    </button>
                    <button id="btn-sincronizar" class="btn-secondary" disabled>
                        üîÑ Sincronizar Google Sheets
                    </button>
                    <button id="btn-configuracion" class="btn-secondary">
                        ‚öôÔ∏è Configuraci√≥n
                    </button>
                </div>
                <div class="controls-right">
                    <button id="btn-nuevo-presupuesto" class="btn-success">
                        ‚ûï Nuevo Presupuesto
                    </button>
                </div>
            </div>

            <!-- Filtros -->
            <div class="filters-section">
                <div class="filter-group">
                    <label for="filtro-categoria">Filtrar por tipo de comprobante:</label>
                    <select id="filtro-categoria">
                        <option value="">Todos los tipos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="buscar-cliente">Buscar cliente:</label>
                    <input type="text" id="buscar-cliente" placeholder="N√∫mero (ej: 123) o nombre del cliente...">
                    <small class="filter-help">üí° Ingrese 3 cifras para buscar por ID o texto para buscar por nombre</small>
                </div>
                <div class="filter-group">
                    <label for="filtro-estado">Filtrar por estado:</label>
                    <select id="filtro-estado" multiple size="4">
                        <option value="" disabled>Cargando estados...</option>
                    </select>
                    <small class="filter-help">üí° Mantenga Ctrl/Cmd para seleccionar m√∫ltiples estados</small>
                </div>
            </div>

            <!-- Tabla de presupuestos -->
            <div class="table-container">
                <table id="tabla-presupuestos" class="presupuestos-table">
                    <thead>
                        <tr>
                            <th width="60">Detalles</th>
                            <th>Tipo de Comprobante</th>
                            <th>Cliente</th>
                            <th>Fecha Registro</th>
                            <th>Estado</th>
                            <th width="120">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tbody-presupuestos">
                        <tr>
                            <td colspan="6" class="no-data">
                                Haga clic en "Cargar Presupuestos" para ver los datos
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Loading indicator -->
            <div id="loading-indicator" class="loading-indicator" style="display: none;">
                <div class="spinner"></div>
                <span>Cargando datos...</span>
            </div>

            <!-- Mensajes de estado -->
            <div id="message-container" class="message-container"></div>
        </main>

        <!-- Modal de Confirmaci√≥n de Eliminaci√≥n -->
        <div id="delete-confirm-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üóëÔ∏è Confirmar Eliminaci√≥n</h3>
                    <button class="modal-close" onclick="closeDeleteConfirmModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="delete-warning">
                        <p><strong>¬øEst√° seguro de que desea eliminar este presupuesto?</strong></p>
                        <p>Esta acci√≥n eliminar√° permanentemente:</p>
                        <ul>
                            <li>El presupuesto completo</li>
                            <li>Todos los detalles de art√≠culos asociados</li>
                        </ul>
                        <p class="warning-text">‚ö†Ô∏è Esta acci√≥n no se puede deshacer.</p>
                    </div>
                    <div id="delete-presupuesto-info" class="presupuesto-info">
                        <!-- Informaci√≥n del presupuesto se cargar√° aqu√≠ -->
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeDeleteConfirmModal()">
                        Cancelar
                    </button>
                    <button type="button" id="btn-confirm-delete" class="btn btn-danger" onclick="confirmDeletePresupuesto()">
                        üóëÔ∏è Eliminar Presupuesto
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal de Configuraci√≥n de Sincronizaci√≥n -->
        <div id="sync-config-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>‚öôÔ∏è Configuraci√≥n de Sincronizaci√≥n Autom√°tica</h3>
                    <button class="modal-close" onclick="closeSyncConfigModal()">&times;</button>
                </div>
                
                <div class="modal-body">
                    <form id="sync-config-form">
                        <!-- Habilitar Sincronizaci√≥n Autom√°tica -->
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="auto_sync_enabled" name="auto_sync_enabled">
                                <span class="checkbox-custom"></span>
                                Habilitar sincronizaci√≥n autom√°tica
                            </label>
                            <small class="form-help">Ejecuta sincronizaci√≥n autom√°ticamente seg√∫n el intervalo configurado</small>
                            <div class="field-error" id="error-auto_sync_enabled"></div>
                        </div>

                        <!-- Intervalo de Sincronizaci√≥n -->
                        <div class="form-group">
                            <label for="sync_interval_minutes">Intervalo de sincronizaci√≥n (minutos):</label>
                            <input type="number" id="sync_interval_minutes" name="sync_interval_minutes" 
                                   min="1" step="1" placeholder="1" required>
                            <small class="form-help">Tiempo entre sincronizaciones autom√°ticas (m√≠nimo 1 minuto)</small>
                            <div class="field-error" id="error-sync_interval_minutes"></div>
                        </div>

                        <!-- Horario de Inicio -->
                        <div class="form-group">
                            <label for="active_hours_start">Horario de inicio:</label>
                            <input type="time" id="active_hours_start" name="active_hours_start" required>
                            <small class="form-help">Hora de inicio de la ventana de sincronizaci√≥n (formato 24h)</small>
                            <div class="field-error" id="error-active_hours_start"></div>
                        </div>

                        <!-- Horario de Fin -->
                        <div class="form-group">
                            <label for="active_hours_end">Horario de fin:</label>
                            <input type="time" id="active_hours_end" name="active_hours_end" required>
                            <small class="form-help">Hora de fin de la ventana de sincronizaci√≥n (formato 24h)</small>
                            <div class="field-error" id="error-active_hours_end"></div>
                        </div>

                        <!-- Zona Horaria -->
                        <div class="form-group">
                            <label for="timezone">Zona horaria:</label>
                            <select id="timezone" name="timezone" required>
                                <option value="America/Argentina/Buenos_Aires">Argentina (Buenos Aires)</option>
                                <option value="America/Argentina/Cordoba">Argentina (C√≥rdoba)</option>
                                <option value="America/Argentina/Mendoza">Argentina (Mendoza)</option>
                                <option value="America/Montevideo">Uruguay (Montevideo)</option>
                                <option value="America/Santiago">Chile (Santiago)</option>
                                <option value="America/Sao_Paulo">Brasil (S√£o Paulo)</option>
                                <option value="America/Lima">Per√∫ (Lima)</option>
                                <option value="America/Bogota">Colombia (Bogot√°)</option>
                                <option value="America/Caracas">Venezuela (Caracas)</option>
                                <option value="UTC">UTC (Tiempo Universal)</option>
                            </select>
                            <small class="form-help">Zona horaria para calcular la ventana de sincronizaci√≥n</small>
                            <div class="field-error" id="error-timezone"></div>
                        </div>
                    </form>

                    <!-- Estado del Scheduler (solo lectura) -->
                    <div class="scheduler-status">
                        <h4>üìä Estado del Scheduler</h4>
                        <div class="status-grid">
                            <div class="status-item">
                                <span class="status-label">Estado:</span>
                                <span id="scheduler-running" class="status-value">-</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">√öltima ejecuci√≥n:</span>
                                <span id="scheduler-last-run" class="status-value">-</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Pr√≥xima ejecuci√≥n:</span>
                                <span id="scheduler-next-run" class="status-value">-</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">√öltimo resultado:</span>
                                <span id="scheduler-last-result" class="status-value">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeSyncConfigModal()">
                        Cancelar
                    </button>
                    <button type="button" id="btn-save-config" class="btn btn-primary" onclick="saveSyncConfig()">
                        üíæ Guardar Configuraci√≥n
                    </button>
                </div>
            </div>
        </div>

        <footer>
            <p>&copy; 2024 Gestiones Lamda - M√≥dulo de Presupuestos v1.0</p>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="/js/presupuestos.js"></script>
    <script src="/js/sync_config_modal.js"></script>
    <!-- Panel nuevo de Google Sheets deshabilitado por defecto -->
    <!-- <script src="/js/gsheets-sync-panel.js"></script> -->
</body>
</html>
